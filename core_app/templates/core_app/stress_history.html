{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stress History</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link
      rel="stylesheet"
      href="{% static 'core_app/css/stress_history.css' %}"
    />
  </head>

  <body>
    <div class="history-page">
      <!-- Header -->
      <div class="page-header">
        <h1>Stress Assessment History</h1>
        <p>Your stress levels over time</p>
      </div>

      <!-- Chart Section -->
      <div class="card chart-card">
        <h3 class="card-title">Stress Trend</h3>
        <canvas id="stressChart"></canvas>
      </div>

      <!-- Records Section -->
      <div class="card table-card">
        <h3 class="card-title">Assessment Records</h3>

        <table class="table table-striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>Score</th>
              <th>Stress Level</th>
            </tr>
          </thead>
          <tbody>
            {% for a in assessments %}
            <tr>
              <td>{{ a.created_at|date:"d M Y, H:i" }}</td>
              <td>{{ a.score }}</td>
              <td>
                {% if a.score <= 13 %}
                <span class="badge low">Low</span>
                {% elif a.score <= 26 %}
                <span class="badge medium">Moderate</span>
                {% else %}
                <span class="badge high">High</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" class="text-center">No assessments found</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Buttons -->
      <div class="action-buttons">
        <a href="{% url 'stress_check' %}" class="btn btn-outline-primary">
          Retake Test
        </a>
        <a href="{% url 'home' %}" class="btn btn-primary"> Go to Home </a>
      </div>
    </div>

    <!-- Chart Script -->
    <script>
      const ctx = document.getElementById("stressChart");

      new Chart(ctx, {
        type: "line",
        data: {
          labels: {{ dates|safe }},
          datasets: [{
            label: "Stress Score",
            data: {{ scores|safe }},
            borderColor: "#022777",
            backgroundColor: "rgba(2, 39, 119, 0.15)",
            fill: true,
            tension: 0.4,
            pointRadius: 5
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 40
            }
          }
        }
      });
    </script>
  </body>
</html>
