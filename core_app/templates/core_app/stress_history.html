{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stress History</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{% static 'core_app/css/stress_history.css' %}"
    />
  </head>

  <body>
    <div class="history-container">
      <!-- Page Header -->
      <div class="page-header">
        <h1>Stress Assessment History</h1>
        <p>Track your stress levels over time</p>
      </div>

      {% if assessments %}

      <!-- Chart Card -->
      <div class="card chart-card">
        <h4 class="card-title">Stress Trend</h4>
        <canvas id="stressChart"></canvas>
      </div>

      <!-- Table Card -->
      <div class="card table-card">
        <h4 class="card-title">Assessment Records</h4>

        <table class="table table-hover">
          <thead>
            <tr>
              <th>Date</th>
              <th>Score</th>
              <th>Stress Level</th>
            </tr>
          </thead>
          <tbody>
            {% for a in assessments %}
            <tr>
              <td>{{ a.created_at|date:"d M Y, H:i" }}</td>
              <td>{{ a.score }}</td>
              <td>
                {% if a.score <= 13 %}
                <span class="badge low">Low</span>
                {% elif a.score <= 26 %}
                <span class="badge medium">Moderate</span>
                {% else %}
                <span class="badge high">High</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% else %}

      <!-- Empty State -->
      <div class="alert alert-info text-center mt-4">
        <strong>No stress history yet.</strong><br />
        Take your first stress assessment to view trends.
      </div>

      {% endif %}

      <!-- Action Buttons -->
      <div class="action-buttons">
        <a href="{% url 'stress_check' %}" class="btn btn-outline-primary">
          Retake Test
        </a>
        <a href="{% url 'home' %}" class="btn btn-primary"> Go to Home </a>
      </div>
    </div>

    {% if assessments %}
    <script>
      const ctx = document.getElementById('stressChart');

      new Chart(ctx, {
          type: 'line',
          data: {
              labels: {{ dates|safe }},
              datasets: [{
                  label: 'Stress Score',
                  data: {{ scores|safe }},
                  borderColor: '#0d6efd',
                  backgroundColor: 'rgba(13, 110, 253, 0.15)',
                  fill: true,
                  tension: 0.4,
                  pointRadius: 5,
                  pointBackgroundColor: '#0d6efd'
              }]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 40,
                      title: {
                          display: true,
                          text: 'Stress Score'
                      }
                  },
                  x: {
                      title: {
                          display: true,
                          text: 'Date'
                      }
                  }
              }
          }
      });
    </script>
    {% endif %}
  </body>
</html>
